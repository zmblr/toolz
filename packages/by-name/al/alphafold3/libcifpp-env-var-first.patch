--- a/src/alphafold3/model/mkdssp_pybind.cc
+++ b/src/alphafold3/model/mkdssp_pybind.cc
@@ -26,17 +26,30 @@ namespace py = pybind11;
 
 void RegisterModuleMkdssp(pybind11::module m) {
   py::module site = py::module::import("site");
-  py::list paths = py::cast<py::list>(site.attr("getsitepackages")());
-  // Find the first path that contains the libcifpp components.cif file.
+
+  // Check LIBCIFPP_DATA_DIR environment variable first (for nix withPackages)
   bool found = false;
-  for (const auto& py_path : paths) {
-    auto path_str =
-        std::filesystem::path(py::cast<absl::string_view>(py_path)) /
-        "share/libcifpp/components.cif";
-    if (std::filesystem::exists(path_str)) {
-      setenv("LIBCIFPP_DATA_DIR", path_str.parent_path().c_str(), 0);
+  const char* env_data_dir = std::getenv("LIBCIFPP_DATA_DIR");
+  if (env_data_dir != nullptr) {
+    auto env_path = std::filesystem::path(env_data_dir) / "components.cif";
+    if (std::filesystem::exists(env_path)) {
+      setenv("LIBCIFPP_DATA_DIR", env_data_dir, 0);
       found = true;
-      break;
+    }
+  }
+
+  py::list paths = py::cast<py::list>(site.attr("getsitepackages")());
+  // Find the first path that contains the libcifpp components.cif file.
+  if (!found) {
+    for (const auto& py_path : paths) {
+      auto path_str =
+          std::filesystem::path(py::cast<absl::string_view>(py_path)) /
+          "share/libcifpp/components.cif";
+      if (std::filesystem::exists(path_str)) {
+        setenv("LIBCIFPP_DATA_DIR", path_str.parent_path().c_str(), 0);
+        found = true;
+        break;
+      }
     }
   }
   if (!found) {
